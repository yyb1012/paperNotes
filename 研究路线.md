之前工作中，节点的语义属性如"文件路径/命令/域名"常被编码为向量。如分层哈希、多标签哈希。但是攻击者可能伪造这些可读名称(路径混淆、软链)，从而误导模型
# IP1：因果不变量一致性校验CIC
提出一组可验证的因果不变量，在对语义属性编码前度量并衰减"可伪造语义"的影响；即当名称、层次结构类似但因果轨迹不合时仍能拉起告警。
## 不变量的CIC评分
- 对于每个不变量先给一个违例强度$v_k(e)∈[0,1]$:
	- 0 = 完全满足；1= 明显违例；
- 整体分数：$S_{CIC}(e)=1-\prod(1-w_kv_k(e))$
	- $v_k(e)$：每条不变量的违例强度。$w_k$：权重
	- 只要有一条强违例，整体风险就会被放大；多条轻微违例也会叠加成较高风险
## 不变量
设溯源图$G=(V,E)$,实体集合含$\{Process，File，Socket，···\}$,对文件$f$ 维护$creater(f),first\_writer(f),first\_exec(f)$及时间戳。定义若干不变量$I_k:$
### $I_1$：执行者对文件的可达性
- 定义：进程执行文件`f`前，应该对于`f`有读/映射路径；凭空执行具有可疑性。如果进程从未见过这个文件就执行 = 严重违例；见过但很久以前见的 = 中度违例；跨命名空间执行 = 附加扣分
- 字段：进程最近对 `f` 的 `read/mmap` 轨迹；挂载空间与命名空间`mntns/pidns`
#### 违例强度：
$v_1=\alpha_1*h[从未读过/映射过]+\alpha_2*f(\Delta t)+\alpha_3*h[跨命名空间]$
- h[·]：指示函数：条件成立=1，不成立=0
- $f(\Delta t)$:时间衰减函数，时间间隔越大，违例越严重
### $I_2$：创建者/首写者一致性
- 定义：文件的创建者$creater(f)$与首写者$first\_writer(f)$应具有较高的一致性，异常跨用户/跨命名空间写入可疑
- 字段：`creator(uid,gid,mntns)`, `first_writer(uid,gid,mntns)`
#### 违例强度
$v_2=1-sim(creator,first\_writer)$
- sim(·,·)：相似度函数
### $I_3$：创建→写→执行的时序性
- 定义：一个文件被执行前，必须先被创建且至少一次写入/映射为可执行
- 字段：`inode`、`fsid`、`mntns`、`event{creat|open|write|exec}`
#### 违例强度：
$v_3=\beta_1*h[缺少创建或写入]+\beta_2*h[顺序错误]+\beta_3*g[\Delta t_{write \Rightarrow exec}]$
- $g(\Delta t_{write \Rightarrow exec})=e^{-\Delta/\tau}$：写入到执行的时间越短，分值越大
### $I_4$：多别名/同形字符
- 定义：同一`inode`在短时间内现异常数量的别名(硬链接、软链接、confĭg)
- 字段：`inode ↔ alias`倒排表
#### 违例强度：
$v_4=h(N_{alias})+\gamma_1*h[同型字符]+\gamma_2*h[软链]+\gamma_3*h[硬链]$
- $h(N_{alias})=1-e^{-N_{alias}/K}$：别名数量越多，违例越高。使用指数函数避免无限增长
## CIC的作用
- 划定阈值，直接报警
- 把 $S_{CIC}$ 作为一个显著的特征喂给图编码器、分类头。把 $S_{CIC}$ 与结构/时序特征拼接，训练时让模型学会"高CIC=高风险"
- 减少最后一步溯源图的工作量，因为CIC知道哪些不变量异常值较高

